microchat.ai {
	# Enable compression (gzip, zstd)
	encode gzip zstd
	
	# Security headers
	header {
		X-Frame-Options "DENY"
		X-Content-Type-Options "nosniff"
		X-XSS-Protection "1; mode=block"
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		Content-Security-Policy "default-src 'none'; frame-ancestors 'none'"
		Referrer-Policy "no-referrer"
		Permissions-Policy "geolocation=(), microphone=(), camera=()"
		-Server
	}
	
	# Request size limit (1MB for compressed gRPC)
	request_body {
		max_size 1MB
	}
	
	@grpc {
		header Content-Type application/grpc*
	}

	handle @grpc {
		reverse_proxy https://localhost:4000 {
			transport http {
				tls_trusted_ca_certs /opt/microchat/certs/ca.crt
			}
		}
	}

	handle {
		respond "Not Found" 404
	}
	
	# Access logging for security monitoring
	log {
		output file /var/log/caddy/access.log {
			roll_size 100mb
			roll_keep 10
		}
		format json
	}
}
